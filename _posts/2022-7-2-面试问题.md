## CAP

#### 1、注册中心

 > **注册中心适合AP还是CP**

注册中心更适合用AP，因为注册中心如果不保证C的话，会出现的后果，就是可能有微服务上线，有些微服务去读某个注册中心实例的时候可以读到新注册的服务，有些微服务去读还没更新好的注册中心可能读不到新注册的服务，这个不会有影响。如果是某个服务下线，同理，有些服务感知到了服务下线，有些感知不到，感知不到的话会导致请求失败。而请求失败我们可以用熔断+降级+重试来进行解决。同时注册中心需要能扛住高并发，也就是能服务于各个服务来抓注册表，心跳等等，也就是说微服务越多，要接受的qps越多，所以qps还是非常高的，而如果用了CP，必然无法扛住这么高的请求。综上，注册中心更适合用AP。



#### 2、Pivotal Cloud Cache 

> Author :  MIKE STOLZ

CAP定理仍然有效，但Pivotal Cloud Cache正在扩展其极限。

Pivotal Cloud Cache（PCC）是Pivotal GemFire的一个专门实现，GemFire是Pivotal基于Apache Geode的商业缓存产品。GemFire在很大程度上偏向于CAP术语的 "强一致性"。PCC有一个额外的优势，即它在Pivotal Cloud Foundry上运行，而Pivotal Cloud Foundry则严重偏重于 "高可用性"。这意味着PCF上的PCC具有独特的地位，能够提供强一致性和非常好的可用性，以及分区容忍度。这为支持新型的横向可扩展数据密集型应用提供了可能性，而这在以前是很难实现的。

让我们进一步深入了解一下这个问题。

ACID中的一致性指的是任何数据库事务必须只以允许的方式改变受影响的数据的要求。任何写入数据库的数据必须根据所有定义的规则有效，包括约束、级联和触发器。一致性被定义为保证：。

未来开始的任何事务必然看到过去提交的其他事务的效果（AKA READ_COMMITTED）

数据库约束不被违反，特别是在事务提交之后

在应用语义方面，事务中的操作被准确、正确地执行，并且具有有效性

CAP定理中的一致性有一个不同的含义。它认为，分布式数据存储不可能同时提供以下三种保证中的两种以上。

一致性。每一次读取都会收到最近的写入，否则就会出现错误。这与ACID中的一致性非常不同。

可用性。每个请求都会收到一个非错误的响应，但不保证它包含最新的写。

分区容忍。尽管节点之间的网络有任意数量的消息被丢弃或延迟，系统仍能继续运行。

CAP定理进一步指出，在一个分布式系统中，你必须要有分区容忍度。这就是CAP中的 "P"。因此，你必须在可用性（A）和一致性（C）之间做出选择，你不可能两者兼得。你可以提供100%的可用性，即所谓的 "AP"，或者100%的一致性，即所谓的 "CP"。在AP和CP阵营中，有许多缓存产品。

理解ACID中的 "C "和CAP中的 "C "之间的区别是非常重要的。你可以让ACID中的 "C "和CAP中的 "AP "一起代表一致性，但你不能让CAP中的 "C "和 "AP "一起代表一致性。

什么样的应用对AP数据存储效果最好？

有一个非常大的数据存储市场，它有利于CAP三角的可用性方面。像Facebook、Google+、Myspace、Instagram、LinkedIn、Pinterest、Snapchat和Twitter等应用都可以从这样的数据存储中受益。这是因为在你的Facebook数据流中，没有实际的财产，也没有任何操作上的后果，为一个条目获取一个旧的值。另外，无论如何，对这种数据几乎没有更新。一切都是插入，所以如果你有一个值，它一定是最新的。

什么类型的应用需要CP数据库？

赞成CAP三角中CP一方的数据存储也有一个巨大的市场。企业所做的事情，如银行、计费、保险、库存、物流、在线电子商务、制造、风险管理和交易，都是受益于CP偏向的数据存储的应用实例。这些应用程序的重度更新性质要求它们在正确和最新的数据上运行。这意味着，在发生网络分区的情况下，如果数据不可用，拥有一份旧的数据拷贝比试图访问它时出错更糟糕。

PCC强烈地偏向CAP三角形的CP一侧。

在网络分割的情况下，PCC将总是返回最近的成功写入，或者一个错误。这就是CAP中一致性的定义。

同时，Pivotal Cloud Foundry为在该平台上运行的服务提供了高可用性，所以它增强了PCC等服务的可用性。

下面是它的工作原理。PCC通过配置成持有多个数据副本，减少了在网络分段期间由于条目不可用而导致的错误返回的可能性。它通过将这些区域的服务器映射到GemFire冗余区域，将这些副本分散到多个PCF可用区域。这减少了一个给定条目的所有副本在网络分割中处于失败一方的可能性。这给我们提供了真正的高（尽管不是100%）可用性，这要归功于PCF，以及通过PCC的强一致性。

两全其美：强一致性和高可用性

PCC的强一致性和PCF的高可用性的结合，真正扩展了CAP定理的边界。你仍然不可能100%地拥有C、A和P三者，但PCF平台的可用性特征与PCC从GemFire继承的强一致性相结合，在PCF上的数据服务中创造了一个真正的突出地位。
